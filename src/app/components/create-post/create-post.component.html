<div class="modal-overlay" [class.show]="show" (click)="onClose()">
  <div class="create-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Post</h2>
      <button class="close-btn" (click)="onClose()">×</button>
    </div>

    <div class="modal-content">
      <!-- File Upload Area -->
      <div class="upload-section">
        <div class="upload-area" *ngIf="selectedFiles.length === 0">
          <input type="file" id="fileInput" multiple accept="image/*" (change)="onFileSelected($event)" style="display: none;">
          <label for="fileInput" class="upload-label">
            <svg class="upload-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            <p>Select photos (1-6 images, max 2MB each)</p>
          </label>
        </div>

        <!-- Image Previews -->
        <div class="image-previews" *ngIf="selectedFiles.length > 0">
          <div class="preview-item" *ngFor="let preview of imagePreviews; let i = index">
            <img [src]="preview" alt="Preview" *ngIf="preview">
            <div class="image-loading" *ngIf="!preview">
              <div class="loading-spinner-small"></div>
            </div>
            <button class="crop-btn" *ngIf="preview" (click)="openCropModal(i, originalImageDataUrls[i] || preview)" title="Adjust crop">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 19V5h14v14H5zm3.5-4L9 13.5 11.5 17H16l-4-5.5L9 16.5z"/>
              </svg>
            </button>
            <button class="remove-btn" *ngIf="preview" (click)="removeImage(i)">×</button>
          </div>
          <div class="add-more" *ngIf="selectedFiles.length < 6">
            <input type="file" id="addMoreInput" multiple accept="image/*" (change)="onFileSelected($event)" style="display: none;">
            <label for="addMoreInput" class="add-more-label">
              <svg class="add-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
            </label>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div class="error-message" *ngIf="uploadError">
        {{ uploadError }}
      </div>

      <!-- Caption Input -->
      <div class="caption-section">
        <label for="caption">Caption</label>
        <textarea 
          id="caption" 
          [(ngModel)]="caption" 
          placeholder="Write a caption..."
          rows="4"
          maxlength="500"></textarea>
        <span class="char-count">{{ caption.length }}/500</span>
      </div>

      <!-- Action Buttons -->
      <div class="modal-actions">
        <button class="btn-cancel" (click)="onClose()" [disabled]="isUploading">Cancel</button>
        <button class="btn-share" (click)="sharePost()" [disabled]="isUploading || selectedFiles.length === 0">
          <span *ngIf="!isUploading">Share</span>
          <span *ngIf="isUploading">Sharing...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Crop Modal -->
  <div class="crop-modal-overlay" [class.show]="showCropModal" *ngIf="showCropModal">
    <div class="crop-modal" (click)="$event.stopPropagation()">
      <div class="crop-header">
        <h3>Adjust Image</h3>
        <button class="crop-close-btn" (click)="closeCropModal()">×</button>
      </div>
      <div class="crop-content">
        <div class="crop-instructions">
          <p>Drag to move • Scroll to zoom • Images will be cropped to square (1000x1000)</p>
        </div>
        <div class="crop-canvas-container">
          <canvas 
            id="cropCanvas"
            (mousedown)="onCropMouseDown($event)"
            (mousemove)="onCropMouseMove($event)"
            (mouseup)="onCropMouseUp()"
            (mouseleave)="onCropMouseUp()"
            (wheel)="onCropWheel($event)"
            class="crop-canvas">
          </canvas>
        </div>
        <div class="crop-actions">
          <button class="btn-crop-cancel" (click)="closeCropModal()">Cancel</button>
          <button class="btn-crop-apply" (click)="applyCrop()">Apply</button>
        </div>
      </div>
    </div>
  </div>
</div>

