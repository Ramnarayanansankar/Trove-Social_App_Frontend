<div class="login-page">
  <!-- Top Section - Logo and Caption -->
  <div class="signup-top">
    <h1 class="promo-title">Trove</h1>
    <p class="promo-text">Share your moments, connect with friends, and discover amazing content.</p>
  </div>

  <div class="login-layout">

    <!-- Right Side - Signup Form -->
    <div class="login-form-side">
      <div class="login-box">
        <h2 class="login-title">Create Your Account</h2>

      <!-- Profile Picture Upload -->
      <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 30px;">
    <div class="profile-picture-container">
      <div class="profile-picture-preview">
        <img 
          [src]="profilePicturePreview" 
          alt="Profile Picture" 
          class="profile-picture-image"
          *ngIf="profilePicturePreview"
        />
        <div class="profile-picture-placeholder" *ngIf="!profilePicturePreview">
          <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
      </div>
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <input 
          type="file" 
          id="profilePictureInput" 
          accept="image/*" 
          (change)="onFileSelected($event)"
          style="display: none;"
          #fileInput
        />
        <button 
          type="button" 
          class="profile-picture-upload-btn"
          (click)="fileInput.click()"
        >
          {{ profilePictureFile ? 'Change Photo' : 'Choose Photo' }}
        </button>
        <button 
          type="button" 
          class="profile-picture-remove-btn"
          (click)="removeProfilePicture()"
          *ngIf="profilePictureFile"
        >
          Remove
        </button>
      </div>
    </div>
    <span class="error-message" *ngIf="profilePictureError" style="margin-top: 10px;">
      {{ profilePictureError }}
    </span>
      </div>

      <form [formGroup]="signupForm" (ngSubmit)="onSubmit()" class="login-form">
    
    <!-- Success Message -->
    <div *ngIf="successMessage" class="success-message">
      {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-message" style="background: #f8d7da; color: #721c24; padding: 12px; border-radius: 8px; margin-bottom: 20px;">
      {{ errorMessage }}
    </div>

    <!-- First Name and Last Name -->
    <div class="form-row">
      <div class="form-group">
        <label class="form-label" for="firstName">First Name *</label>
        <input
          type="text"
          id="firstName"
          formControlName="firstName"
          class="form-control"
          [class.error]="submitted && f['firstName'].invalid"
          placeholder="Enter your first name"
        />
        <span class="error-message" *ngIf="getFieldError('firstName')">
          {{ getFieldError('firstName') }}
        </span>
      </div>

      <div class="form-group">
        <label class="form-label" for="lastName">Last Name *</label>
        <input
          type="text"
          id="lastName"
          formControlName="lastName"
          class="form-control"
          [class.error]="submitted && f['lastName'].invalid"
          placeholder="Enter your last name"
        />
        <span class="error-message" *ngIf="getFieldError('lastName')">
          {{ getFieldError('lastName') }}
        </span>
      </div>
    </div>

    <!-- Email -->
    <div class="form-group">
      <label class="form-label" for="email">Email *</label>
      <input
        type="email"
        id="email"
        formControlName="email"
        class="form-control"
        [class.error]="(submitted || f['email'].dirty || f['email'].touched) && f['email'].invalid"
        placeholder="Enter your email address"
      />
      <!-- Email format errors (only show if not emailExists error) -->
      <span class="error-message" *ngIf="getFieldError('email') && !f['email'].errors?.['emailExists']">
        {{ getFieldError('email') }}
      </span>
      <!-- Email availability status -->
      <span *ngIf="emailChecking && f['email'].valid && !f['email'].errors?.['email']" 
            style="color: #667eea; font-size: 13px; margin-top: 5px; display: block;">
        <span style="display: inline-block; width: 12px; height: 12px; border: 2px solid #667eea; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 5px;"></span>
        Checking email availability...
      </span>
      <span *ngIf="!emailChecking && emailAvailable === true && f['email'].valid && !f['email'].errors?.['email']" 
            style="color: #10b981; font-size: 13px; margin-top: 5px; display: block;">
        ✓ Email is available
      </span>
      <!-- Email exists error (show only once) -->
      <span class="error-message" *ngIf="!emailChecking && (f['email'].errors?.['emailExists'] || emailAvailable === false)">
        ✗ Email already exists
      </span>
    </div>

    <!-- Password -->
    <div class="form-group">
      <label class="form-label" for="password">Password *</label>
      <input
        type="password"
        id="password"
        formControlName="password"
        class="form-control"
        [class.error]="submitted && f['password'].invalid"
        placeholder="Enter a strong password"
      />
      <span class="error-message" *ngIf="getFieldError('password')">
        {{ getFieldError('password') }}
      </span>
      <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
        Must contain uppercase, lowercase, number, and special character
      </small>
    </div>

    <!-- Phone Number and Gender -->
    <div class="form-row">
      <div class="form-group">
        <label class="form-label" for="phoneNumber">Phone Number *</label>
        <input
          type="tel"
          id="phoneNumber"
          formControlName="phoneNumber"
          class="form-control"
          [class.error]="(submitted || f['phoneNumber'].dirty || f['phoneNumber'].touched) && f['phoneNumber'].invalid"
          placeholder="+1 (555) 123-4567"
        />
        <!-- Phone number format errors (only show if not phoneNumberExists error) -->
        <span class="error-message" *ngIf="getFieldError('phoneNumber') && !f['phoneNumber'].errors?.['phoneNumberExists']">
          {{ getFieldError('phoneNumber') }}
        </span>
        <!-- Phone number availability status -->
        <span *ngIf="phoneNumberChecking && f['phoneNumber'].valid && !f['phoneNumber'].errors?.['pattern']" 
              style="color: #667eea; font-size: 13px; margin-top: 5px; display: block;">
          <span style="display: inline-block; width: 12px; height: 12px; border: 2px solid #667eea; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 5px;"></span>
          Checking phone number availability...
        </span>
        <span *ngIf="!phoneNumberChecking && phoneNumberAvailable === true && f['phoneNumber'].valid && !f['phoneNumber'].errors?.['pattern']" 
              style="color: #10b981; font-size: 13px; margin-top: 5px; display: block;">
          ✓ Phone number is available
        </span>
        <!-- Phone number exists error (show only once) -->
        <span class="error-message" *ngIf="!phoneNumberChecking && (f['phoneNumber'].errors?.['phoneNumberExists'] || phoneNumberAvailable === false)">
          ✗ Phone number already exists
        </span>
      </div>

      <div class="form-group">
        <label class="form-label" for="gender">Gender *</label>
        <select
          id="gender"
          formControlName="gender"
          class="form-control"
          [class.error]="submitted && f['gender'].invalid"
        >
          <option value="">Select Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
          <option value="prefer-not-to-say">Prefer not to say</option>
        </select>
        <span class="error-message" *ngIf="getFieldError('gender')">
          {{ getFieldError('gender') }}
        </span>
      </div>
    </div>

    <!-- Date of Birth -->
    <div class="form-group">
      <label class="form-label" for="dob">Date of Birth *</label>
      <input
        type="date"
        id="dob"
        formControlName="dob"
        class="form-control"
        [class.error]="submitted && f['dob'].invalid"
      />
      <span class="error-message" *ngIf="getFieldError('dob')">
        {{ getFieldError('dob') }}
      </span>
    </div>

    <!-- Country, State, City -->
    <div class="form-row">
      <div class="form-group">
        <label class="form-label" for="country">Country *</label>
        <select
          id="country"
          formControlName="country"
          class="form-control"
          [class.error]="submitted && f['country'].invalid"
        >
          <option value="">Select Country</option>
          <option *ngFor="let country of countries" [value]="country">
            {{ country }}
          </option>
        </select>
        <span class="error-message" *ngIf="getFieldError('country')">
          {{ getFieldError('country') }}
        </span>
      </div>

      <div class="form-group">
        <label class="form-label" for="state">State *</label>
        <select
          id="state"
          formControlName="state"
          class="form-control"
          [class.error]="submitted && f['state'].invalid"
        >
          <option value="">Select State</option>
          <option *ngFor="let state of availableStates" [value]="state">
            {{ state }}
          </option>
        </select>
        <span class="error-message" *ngIf="getFieldError('state')">
          {{ getFieldError('state') }}
        </span>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label" for="city">City *</label>
      <select
        id="city"
        formControlName="city"
        class="form-control"
        [class.error]="submitted && f['city'].invalid"
      >
        <option value="">Select City</option>
        <option *ngFor="let city of availableCities" [value]="city">
          {{ city }}
        </option>
      </select>
      <span class="error-message" *ngIf="getFieldError('city')">
        {{ getFieldError('city') }}
      </span>
    </div>

    <!-- Address -->
    <div class="form-group">
      <label class="form-label" for="address">Address *</label>
      <textarea
        id="address"
        formControlName="address"
        class="form-control"
        [class.error]="submitted && f['address'].invalid"
        rows="3"
        placeholder="Enter your full address"
      ></textarea>
      <span class="error-message" *ngIf="getFieldError('address')">
        {{ getFieldError('address') }}
      </span>
    </div>

    <!-- Pincode -->
    <div class="form-group">
      <label class="form-label" for="pincode">Pincode *</label>
      <input
        type="text"
        id="pincode"
        formControlName="pincode"
        class="form-control"
        [class.error]="submitted && f['pincode'].invalid"
        placeholder="Enter pincode"
        maxlength="6"
      />
      <span class="error-message" *ngIf="getFieldError('pincode')">
        {{ getFieldError('pincode') }}
      </span>
    </div>

      <!-- Submit Button -->
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="isLoading"
      >
        <span *ngIf="!isLoading">Create Account</span>
        <span *ngIf="isLoading">Creating Account...</span>
      </button>
      </form>

      <!-- Divider -->
      <div class="login-divider">
        <span>OR</span>
      </div>

      <!-- Login Link -->
      <div class="login-signup">
        <p>
          Already have an account? 
          <a routerLink="/login" class="signup-link">Sign in</a>
        </p>
      </div>
    </div>
  </div>
</div>

